<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ESP32 BLE Joystick + 4 Servos</title>
  <style>
    :root{
      --bg:#1a2430;
      --card:#0b1220;
      --panel:#111827;
      --accent:#0ea5e9;
      --muted:#94a3b8;
      --glass: rgba(255,255,255,0.03);
      --radius:14px;
    }
    html,body{
      height:100%;margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;
      background:linear-gradient(180deg,var(--bg),#192735);
      color:#e6eef6;
    }

    .app {
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:20px;
      max-width:1150px;
      margin:18px auto;
      padding:16px;
    }

    @media (max-width:900px){
      .app{grid-template-columns:1fr; padding:12px;}
      .side { order: 2; }
      .main { order: 1; }
      .sliders { flex-direction:row; gap:10px; justify-content:center; flex-wrap:wrap; }
      .servoCard { width:90%; }
      input[type="range"]{ width:90vw; }
      #joystick { width:260px; height:260px; }
    }

    .card{
      background: linear-gradient(180deg,var(--card),#08131f);
      border-radius:var(--radius);
      padding:14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.04);
    }

    .main { display:flex; flex-direction:column; gap:16px; min-height:380px; }
    h2{margin:0 0 6px 0;font-size:18px;color:var(--accent)}
    .statusRow{display:flex;align-items:center;gap:12px;justify-content:space-between}
    #status{
      font-size:13px;padding:8px 10px;border-radius:10px;background:var(--glass);color:var(--muted);
      display:inline-block; min-width:220px;
    }
    #connectBtn{
      background:var(--accent); color:#021026; border:none; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer;
      box-shadow: 0 6px 12px rgba(14,165,233,0.12);
    }

    .controller {
      display:flex; gap:18px; align-items:center; justify-content:center; padding:8px; flex-wrap:wrap;
    }

    #joystick {
      width:320px; height:320px; border-radius:50%;
      background: radial-gradient(circle at 50% 45%, #0b1320 0%, #071018 80%);
      position:relative; display:flex;align-items:center;justify-content:center;
      box-shadow: 0 8px 24px rgba(0,0,0,0.5), inset 0 -8px 24px rgba(255,255,255,0.04);
      touch-action: none;
      border: 2px solid rgba(255,255,255,0.08);
    }
    .gridRings{
      position:absolute; inset:0; border-radius:50%; pointer-events:none;
      background:
        radial-gradient(circle at center, rgba(255,255,255,0.05) 0, rgba(255,255,255,0.0) 60%),
        radial-gradient(circle, rgba(255,255,255,0.02) 1px, transparent 1px);
      opacity:0.7;
    }
    #stick{
      width:96px;height:96px;border-radius:50%;
      background:linear-gradient(180deg,var(--accent),#0369a1);
      box-shadow: 0 6px 18px rgba(10,140,200,0.24), 0 2px 6px rgba(0,0,0,0.6);
      position:absolute; transform:translate(-50%,-50%); left:50%; top:50%;
      touch-action: none;
      transition: left 0.02s linear, top 0.02s linear;
    }

    #rotationButtons{display:flex;flex-direction:column;gap:12px;align-items:center}
    .rotBtn{
      width:86px;height:86px;border-radius:50%; border:none;
      font-size:30px; display:flex;align-items:center;justify-content:center;
      background:#0b1622;color:var(--accent);
      box-shadow:0 8px 18px rgba(0,0,0,0.6);
      cursor:pointer; user-select:none;
      touch-action: manipulation;
    }
    .rotBtn.pressed{ transform: translateY(2px); opacity:0.9; filter:brightness(1.05); }

    .side { width:100%; max-width:380px; }
    .sliders{ display:flex; flex-direction:column; gap:16px; margin-top:10px; }
    .servoCard{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:12px; border-radius:12px;
      background:linear-gradient(180deg,#08141c,#061018);
      box-shadow:inset 0 0 4px rgba(255,255,255,0.02);
    }
    .servoLabel{ font-size:14px; color:var(--muted); width:72px; }
    .servoControl{ display:flex; gap:10px; align-items:center; width:100%; }
    input[type="range"]{
      -webkit-appearance:none; appearance:none;
      height:40px; width:100%;
      background:transparent; touch-action:none;
    }
    input[type="range"]::-webkit-slider-runnable-track{
      height:10px; border-radius:20px;
      background: linear-gradient(90deg,#0d1828,#0e3b5e);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
    }
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;
      width:38px; height:38px; border-radius:50%; margin-top:-14px;
      background:linear-gradient(180deg,var(--accent),#0369a1);
      box-shadow:0 6px 16px rgba(10,140,200,0.25);
    }
    .servoValue{ width:48px; text-align:center; font-weight:700; color:#e6eef6; font-size:15px; }

    .hint{ font-size:12px;color:var(--muted); margin-top:6px }
  </style>
</head>
<body>
  <div class="app">
    <div class="main card">
      <h2>ESP32 BLE Joystick Controller</h2>
      <div class="statusRow">
        <div id="status">Êú™Êé•Á∂ö</div>
        <div>
          <button id="connectBtn">Êé•Á∂ö</button>
          <button id="reconnectBtn" style="margin-left:8px;padding:8px 10px;border-radius:8px;background:#0b1220;border:1px solid rgba(255,255,255,0.04);color:var(--muted);cursor:pointer;">ÂÜçÊé•Á∂ö</button>
        </div>
      </div>

      <div class="controller">
        <div id="joystick" aria-label="joystick">
          <div class="gridRings"></div>
          <div id="stick" role="application" aria-label="stick"></div>
        </div>

        <div id="rotationButtons">
          <button id="leftRotate" class="rotBtn" aria-label="rotate left">‚ü≤</button>
          <button id="rightRotate" class="rotBtn" aria-label="rotate right">‚ü≥</button>
        </div>
      </div>

      <!-- üîΩ Motor „Çπ„É©„Ç§„ÉÄ„Éº -->
      <div class="servoCard" style="margin-top:10px;">
        <div class="servoLabel">Motor</div>
        <div class="servoControl">
          <input id="motorSlider" type="range" min="-1" max="1" value="0" step="0.01" />
          <div class="servoValue" id="motorVal">0.00</div>
        </div>
      </div>

      <div class="hint">‚Äª „Çπ„ÉÜ„Ç£„ÉÉ„ÇØ„ÅØÊåá„ÅßÊäº„Åó„Å¶„Éâ„É©„ÉÉ„Ç∞„ÄÅÊåá„ÇíÈõ¢„Åô„Å®‰∏≠ÂøÉ„Å´Êàª„Çä„Åæ„Åô„ÄÇÂõûËª¢„ÅØÊäº„Åó„Å¶„ÅÑ„ÇãÈñì„Å†„ÅëÂõûËª¢„Ç≥„Éû„É≥„Éâ„ÄÇ</div>
    </div>

    <div class="side card">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div style="font-weight:700">Servo Controls</div>
        <div style="font-size:13px;color:var(--muted)">0„Äú180¬∞</div>
      </div>

      <div class="sliders">
        <div class="servoCard">
          <div class="servoLabel">Servo 1</div>
          <div class="servoControl">
            <input id="s1" type="range" min="0" max="180" value="90" />
            <div class="servoValue" id="s1val">90</div>
          </div>
        </div>

        <div class="servoCard">
          <div class="servoLabel">Servo 2</div>
          <div class="servoControl">
            <input id="s2" type="range" min="0" max="180" value="90" />
            <div class="servoValue" id="s2val">90</div>
          </div>
        </div>

        <div class="servoCard">
          <div class="servoLabel">Servo 3</div>
          <div class="servoControl">
            <input id="s3" type="range" min="0" max="180" value="90" />
            <div class="servoValue" id="s3val">90</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
let bleDevice, bleCharacteristic;

async function connectBLE() {
  try {
    bleDevice = await navigator.bluetooth.requestDevice({
      filters: [{ namePrefix: "MyRobotController_" }],
      optionalServices: ["12345678-1234-5678-1234-56789abcdef0"]
    });

    const server = await bleDevice.gatt.connect();
    const service = await server.getPrimaryService("12345678-1234-5678-1234-56789abcdef0");
    bleCharacteristic = await service.getCharacteristic("abcd1234-1234-5678-1234-56789abcdef0");

    statusEl.textContent = "Êé•Á∂öÊ∏à„Åø";
    statusEl.style.color = "#0ea5e9";
  } catch (error) {
    console.error("Êé•Á∂ö„Ç®„É©„Éº:", error);
    statusEl.textContent = "Êé•Á∂öÂ§±Êïó";
    statusEl.style.color = "#ef4444";
  }
}

    function sendBLEData(type, value) {
      if (!bleCharacteristic) return;
      const msg = `${type}:${value}\n`;
      bleCharacteristic.writeValue(new TextEncoder().encode(msg));
    }

    document.getElementById("connectBtn").addEventListener("click", connectBLE);

    const motorSlider = document.getElementById("motorSlider");
    const motorVal = document.getElementById("motorVal");
    motorSlider.addEventListener("input", () => {
      const val = parseFloat(motorSlider.value).toFixed(2);
      motorVal.textContent = val;
      sendBLEData("motor", val);
    });
  </script>
</body>
</html>

